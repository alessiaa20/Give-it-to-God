<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lay It Down â€” Give It to God</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ======= STYLE (unchanged visually) ======= */
:root{
--bg:#0b0620;--card:rgba(255,255,255,.08);
--accent:#a855f7;--accent2:#7c3aed;
--text:#f5f3ff;--muted:#c4b5fd
}
*{box-sizing:border-box;font-family:Inter,system-ui,sans-serif}
body{
margin:0;min-height:100vh;color:var(--text);
background:linear-gradient(180deg,#05010f,#0b0620)
}
.hidden{display:none}
.btn{
border:none;border-radius:999px;padding:12px 22px;
cursor:pointer;color:white;
background:linear-gradient(135deg,var(--accent),var(--accent2))
}
.btn.secondary{
background:rgba(255,255,255,.1);
border:1px solid rgba(255,255,255,.18)
}
.btn.danger{background:linear-gradient(135deg,#fb7185,#ef4444)}
#lock,#app{padding:24px;max-width:900px;margin:auto}
textarea{
width:100%;min-height:140px;border-radius:18px;
background:transparent;border:2px solid rgba(255,255,255,.15);
padding:16px;color:white
}
.card{
background:var(--card);border-radius:26px;
padding:22px;margin-bottom:18px
}
.prayer{
background:rgba(255,255,255,.07);
border-radius:18px;padding:14px;margin-bottom:10px;
position:relative
}
.prayer .x{
position:absolute;top:8px;right:12px;cursor:pointer
}
</style>
</head>

<body>

<!-- LOCK -->
<div id="lock">
  <h1>Lay It Down</h1>
  <p>Give it to God. Leave it here.</p>

  <input id="pass" type="password" placeholder="Passcode (faith)">
  <br><br>
  <button class="btn" id="enterBtn">Enter</button>
  <button class="btn secondary" id="googleBtn">Sign in with Google</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
  <h1>Lay It Down</h1>

  <div class="card">
    <textarea id="text" placeholder="Write it hereâ€¦"></textarea>
    <br><br>
    <button class="btn" id="releaseBtn">Release</button>
  </div>

  <div class="card">
    <button class="btn" id="pdfBtn">Export PDF</button>
    <button class="btn danger" id="burnBtn">Burn All</button>
    <button class="btn secondary" id="signOutBtn">Sign Out</button>
  </div>

  <div class="card" id="list"></div>
  <footer id="stats"></footer>
</div>

<div id="toast"></div>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
  apiKey: "AIzaSyB_EKQ043IqazKMXeTE_bUrRzLJ1W4NVRM",
  authDomain: "give-it-to-god.firebaseapp.com",
  projectId: "give-it-to-god"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* ================= STATE ================= */
const PASS = "faith";
let prayers = JSON.parse(localStorage.getItem("prayers")||"[]");
let cloudTimer = null;

/* ================= UI ================= */
const lock = document.getElementById("lock");
const app  = document.getElementById("app");
const list = document.getElementById("list");
const text = document.getElementById("text");
const stats= document.getElementById("stats");

function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;t.style.opacity=1;
  setTimeout(()=>t.style.opacity=0,2200);
}

function showApp(){
  lock.classList.add("hidden");
  app.classList.remove("hidden");
  render();
}

auth.onAuthStateChanged(async user=>{
  if(!user){
    app.classList.add("hidden");
    lock.classList.remove("hidden");
    return;
  }
  await loadFromCloud();
  showApp();
});

/* ================= AUTH ================= */
async function signInAnon(){
  await auth.signInAnonymously();
}

async function signInGoogle(){
  const provider=new firebase.auth.GoogleAuthProvider();
  try{
    await auth.signInWithPopup(provider);
  }catch{
    await auth.signInWithRedirect(provider);
  }
}

async function signOut(){
  await auth.signOut();
}

/* ================= FIRESTORE ================= */
function cloudDoc(){
  return db.collection("prayers").doc(auth.currentUser.uid);
}

async function loadFromCloud(){
  const snap=await cloudDoc().get();
  if(snap.exists){
    prayers=snap.data().items||[];
    localStorage.setItem("prayers",JSON.stringify(prayers));
  }else saveToCloud();
}

function saveToCloud(){
  cloudDoc().set({items:prayers,updated:Date.now()},{merge:true});
}

function save(){
  localStorage.setItem("prayers",JSON.stringify(prayers));
  clearTimeout(cloudTimer);
  cloudTimer=setTimeout(saveToCloud,600);
  render();
}

/* ================= PRAYERS ================= */
function add(){
  if(!text.value.trim())return;
  prayers.unshift({text:text.value,time:new Date().toLocaleString()});
  text.value="";
  save();toast("Released ðŸ•Šï¸");
}

function burn(){
  if(!confirm("Delete all prayers?"))return;
  prayers=[];save();
}

function render(){
  list.innerHTML="";
  prayers.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="prayer";
    d.innerHTML=`<div class="x">âœ•</div>${p.text}<br><small>${p.time}</small>`;
    d.querySelector(".x").onclick=()=>{prayers.splice(i,1);save();}
    list.appendChild(d);
  });
  stats.textContent=`${prayers.length} prayers`;
}

/* ================= EVENTS ================= */
document.getElementById("enterBtn").onclick=()=>{
  if(document.getElementById("pass").value!==PASS)
    return toast("Wrong passcode");
  if(!auth.currentUser) signInAnon();
};

document.getElementById("googleBtn").onclick=signInGoogle;
document.getElementById("signOutBtn").onclick=signOut;
document.getElementById("releaseBtn").onclick=add;
document.getElementById("burnBtn").onclick=burn;
</script>
</body>
</html>
